<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Barkod Yazdır</title>
  <style>
    @page { size: 100mm 100mm; margin: 0; }
    html, body { width: 100mm; height: 100mm; margin: 0; padding: 0; background: #fff; }
    body { display: flex; align-items: center; justify-content: center; }
    #barcode { width: 100mm; height: 100mm; object-fit: contain; image-rendering: -webkit-optimize-contrast; image-rendering: crisp-edges; }
  </style>
</head>
<body>
  <img id="barcode" alt="Barkod" />
  <script>
    window.showBarcode = function (base64) {
      const img = new Image();
      img.src = "data:image/png;base64," + base64;
      img.onload = () => {
        try {
          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");
          const cropSize = 800;
          const srcW = img.width, srcH = img.height;
          const size = Math.min(srcW, srcH);
          const side = Math.min(size, cropSize);
          const x = Math.floor((srcW - side) / 2);
          const y = Math.floor((srcH - side) / 2);
          canvas.width  = cropSize;
          canvas.height = cropSize;
          ctx.drawImage(img, x, y, side, side, 0, 0, cropSize, cropSize);
          document.getElementById("barcode").src = canvas.toDataURL("image/png");
          setTimeout(() => { window.print(); setTimeout(() => window.close(), 500); }, 200);
        } catch (e) {
          document.getElementById("barcode").src = "data:image/png;base64," + base64;
          setTimeout(() => { window.print(); setTimeout(() => window.close(), 500); }, 200);
        }
      };
      img.onerror = () => { alert("Barkod resmi yüklenemedi."); window.close(); };
    };
  </script>
</body>
</html>
